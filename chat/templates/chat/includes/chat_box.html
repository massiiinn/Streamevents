{% load static %}

<!-- =================== CARREGAR CSS DEL XAT =================== -->
<link rel="stylesheet" href="{% static 'chat/css/chat.css' %}">

<!-- =================== CONTENIDOR PRINCIPAL =================== -->
<!-- data-event-id: passa l'ID de l'esdeveniment al JavaScript -->
<!-- data-username: passa el nom de l'usuari actual al JavaScript -->
<div class="chat-container" 
     data-event-id="{{ event.id }}"
     data-username="{{ user.username }}"> 

    <!-- =================== CAPALERA =================== -->
    <!-- Emoji de xat i comptador de missatges -->
    <div class="chat-header">
        <span></span>
        <!-- Badge que mostra el nombre de missatges (actualitzat pel JS) -->
        <span id="message-count" class="badge bg-primary">0</span>
    </div>

    <!-- =================== REA DE MISSATGES =================== -->
    <!-- Aqu铆 es mostraran dinmicament tots els missatges del xat -->
    <div id="chat-messages" class="chat-messages">
        <!-- Spinner inicial mentre carreguen els missatges -->
        <div class="text-center text-muted py-4">
            <div class="spinner-border spinner-border-sm me-2"></div>
            Carregant missatges...
        </div>
    </div>

    <!-- =================== CONTENIDOR D'ERRORS =================== -->
    <!-- Aqu铆 es mostren els errors de validaci贸 del formulari -->
    <div id="chat-errors" class="px-3"></div>

    <!-- =================== FORMULARI D'ENVIAMENT =================== -->
    <!-- Nom茅s es mostra si: l'usuari est autenticat i l'esdeveniment est en directe -->
    {% if user.is_authenticated and event.status == 'live' %}
    <form id="chat-form" class="chat-form d-flex gap-2">
        {% csrf_token %} <!-- Token de seguretat per prevenir atacs CSRF -->
        <!-- Textarea on l'usuari escriu el missatge -->
        <textarea name="message" class="form-control" rows="2" 
                  placeholder="Escriu un missatge..." maxlength="500" required></textarea>
        <!-- Bot贸 per enviar el missatge -->
        <button type="submit" class="btn btn-primary">Enviar</button>
    </form>
    
    <!-- =================== MISSATGE: NO AUTENTICAT =================== -->
    <!-- Es mostra si l'usuari no ha iniciat sessi贸 -->
    {% elif not user.is_authenticated %}
    <div class="p-3 text-center border-top">
        <p class="text-muted mb-0">
            <i class="fas fa-sign-in-alt me-1"></i>
            Inicia sessi贸 per participar al xat
        </p>
    </div>
    
    <!-- =================== MISSATGE: ESDEVENIMENT NO EN DIRECTE =================== -->
    <!-- Es mostra si l'esdeveniment no est amb status='live' -->
    {% else %}
    <div class="p-3 text-center border-top">
        <p class="text-muted mb-0">
            <i class="fas fa-video-slash me-1"></i>
            El xat nom茅s est disponible durant l'esdeveniment en directe
        </p>
    </div>
    {% endif %}
</div>

<!-- =================== CARREGAR JAVASCRIPT DEL XAT =================== -->
<!-- S'executa despr茅s del HTML per assegurar que tots els elements existeixen -->
<script src="{% static 'chat/js/chat.js' %}"></script>