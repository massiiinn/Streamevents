{% extends "base.html" %}
{% block title %}Has oblidat la contrasenya{% endblock %}

{% block content %}
<!-- Contenidor centrat vertical i horitzontal amb alçada mínima -->
<div class="d-flex justify-content-center align-items-center" style="min-height:70vh;">
  <!-- Targeta amb ombra per al formulari -->
  <div class="card shadow p-4 border-0" style="max-width: 500px; width: 100%;">
    <h3 class="text-center mb-4">Restableix la teva contrasenya</h3>

    <!-- Mostra missatges flash si n'hi ha -->
    {% if messages %}
      {% for message in messages %}
        <div class="alert alert-{{ message.tags }} mb-3">{{ message }}</div>
      {% endfor %}
    {% endif %}

    <!-- Formulari POST amb CSRF -->
    <form method="POST">
      {% csrf_token %}
      <!-- Camp de nom d'usuari -->
      <div class="mb-3">
        <label for="username" class="form-label">Nom d'usuari</label>
        <input type="text" class="form-control" id="username" name="username" required>
      </div>

      <!-- Camp de nova contrasenya -->
      <div class="mb-3">
        <label for="new_password" class="form-label">Nova contrasenya</label>
        <input type="password" class="form-control" id="new_password" name="new_password" required>
      </div>

      <!-- Camp de confirmació de contrasenya amb missatge de validació en temps real -->
      <div class="mb-3">
        <label for="confirm_password" class="form-label">Repeteix la nova contrasenya</label>
        <input type="password" class="form-control" id="confirm_password" name="confirm_password" required>
        <small id="password-match-msg" class="d-block mt-1"></small>
      </div>

      <!-- Botó d'enviament -->
      <button type="submit" class="btn btn-success w-100 mt-3">Restableix contrasenya</button>
    </form>

    <!-- Enllaç per tornar al login -->
    <div class="text-center mt-3">
      <a href="{% url 'users:login' %}">Tornar endarrere</a>
    </div>
  </div>
</div>

<!-- Script per comprovar en temps real si les contrasenyes coincideixen -->
<script>
document.addEventListener('DOMContentLoaded', () => {
  const pw1 = document.querySelector('#new_password');
  const pw2 = document.querySelector('#confirm_password');
  const msg = document.querySelector('#password-match-msg');
  if (!pw1 || !pw2 || !msg) return;

  pw2.addEventListener('input', () => {
    if (pw1.value && pw2.value) {
      if (pw1.value === pw2.value) {
        msg.textContent = "✅ Les contrasenyes coincideixen";
        msg.style.color = "green";
      } else {
        msg.textContent = "❌ Les contrasenyes no coincideixen";
        msg.style.color = "red";
      }
    } else {
      msg.textContent = "";
    }
  });
});
</script>
{% endblock %}
